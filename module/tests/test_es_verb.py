import enwiktionary_templates.module.es_verb as M
import re

#added_combos = []
#for p1 in ["me", "te", "se", "nos", "os"]:
#    for p2 in ["lo", "la", "le", "los", "las", "les"]:
#        added_combos.append(p1+p2)
#extended_combos = tuple(added_combos)

def test_check_slots():
    assert len(M.verb_slots_basic) == 74
    assert len(M.verb_slots_combined) == 217
    assert len(M.all_verb_slots) == 291

#    assert len(list(x for x in M.verb_slots_combined.keys() if re.match(r".*_(.*)", x).group(1) not in extended_combos)) == 67
#    assert len(list(x for x in M.all_verb_slots.keys() if re.match(r".*_(.*)", x).group(1) not in extended_combos)) == 141

def test_generate_forms():
    args = { 1: None }
    d = {}
    from_headword = False

    def compare(wiki, full):
        full = full.replace("[[", "").replace("]]", "")
        wiki = wiki.replace("[[", "").replace("]]", "")

        # fix for imperatives bug in orignal output
        wiki = wiki.replace("imp_3s", "imp_2sf")
        wiki = wiki.replace("imp_3p", "imp_2pf")
        full_idx = tuple(full.split("|"))
        for i in wiki.split("|"):
            if i not in full_idx:
                k,v = i.split("=",2)
                for i2 in full_idx:
                    k2,v2 = i2.split("=",2)
                    if k2 == k:
                        raise ValueError(f"'{i}' does not match '{k2}={v2}'")
                raise ValueError(i + " key not found in " + full)

    #assert "|".join(sorted(joined.split("|"))) == "|".join(sorted(baseline.split("|")))


    PAGENAME = "tener"
    # curl 'https://en.wiktionary.org/w/api.php?action=expandtemplates&format=json&prop=wikitext&text=%7B%7BUser:JeffDoozan/es-verb-generate-forms|tener%7D%7D'
    baseline = "infinitive=tener|infinitive_linked=tener|gerund=teniendo|pp_ms=tenido|pp_fs=tenida|pp_mp=tenidos|pp_fp=tenidas|pres_1s=tengo|pres_2s=tienes|pres_2sv=tenés|pres_3s=tiene|pres_1p=tenemos|pres_2p=tenéis|pres_3p=tienen|impf_1s=tenía|impf_2s=tenías|impf_3s=tenía|impf_1p=teníamos|impf_2p=teníais|impf_3p=tenían|pret_1s=tuve|pret_2s=tuviste|pret_3s=tuvo|pret_1p=tuvimos|pret_2p=tuvisteis|pret_3p=tuvieron|fut_1s=tendré|fut_2s=tendrás|fut_3s=tendrá|fut_1p=tendremos|fut_2p=tendréis|fut_3p=tendrán|cond_1s=tendría|cond_2s=tendrías|cond_3s=tendría|cond_1p=tendríamos|cond_2p=tendríais|cond_3p=tendrían|pres_sub_1s=tenga|pres_sub_2s=tengas|pres_sub_2sv=tengás|pres_sub_3s=tenga|pres_sub_1p=tengamos|pres_sub_2p=tengáis|pres_sub_3p=tengan|impf_sub_ra_1s=tuviera|impf_sub_ra_2s=tuvieras|impf_sub_ra_3s=tuviera|impf_sub_ra_1p=tuviéramos|impf_sub_ra_2p=tuvierais|impf_sub_ra_3p=tuvieran|impf_sub_se_1s=tuviese|impf_sub_se_2s=tuvieses|impf_sub_se_3s=tuviese|impf_sub_se_1p=tuviésemos|impf_sub_se_2p=tuvieseis|impf_sub_se_3p=tuviesen|fut_sub_1s=tuviere|fut_sub_2s=tuvieres|fut_sub_3s=tuviere|fut_sub_1p=tuviéremos|fut_sub_2p=tuviereis|fut_sub_3p=tuvieren|imp_2s=ten|imp_2sv=tené|imp_3s=tenga|imp_1p=tengamos|imp_2p=tened|imp_3p=tengan|neg_imp_2s=[[no]] [[tengas]]|neg_imp_3s=[[no]] [[tenga]]|neg_imp_1p=[[no]] [[tengamos]]|neg_imp_2p=[[no]] [[tengáis]]|neg_imp_3p=[[no]] [[tengan]]|infinitive_comb_me=tenerme|infinitive_comb_te=tenerte|infinitive_comb_se=tenerse|infinitive_comb_nos=tenernos|infinitive_comb_os=teneros|infinitive_comb_lo=tenerlo|infinitive_comb_la=tenerla|infinitive_comb_le=tenerle|infinitive_comb_los=tenerlos|infinitive_comb_las=tenerlas|infinitive_comb_les=tenerles|gerund_comb_me=teniéndome|gerund_comb_te=teniéndote|gerund_comb_se=teniéndose|gerund_comb_nos=teniéndonos|gerund_comb_os=teniéndoos|gerund_comb_lo=teniéndolo|gerund_comb_la=teniéndola|gerund_comb_le=teniéndole|gerund_comb_los=teniéndolos|gerund_comb_las=teniéndolas|gerund_comb_les=teniéndoles|imp_2s_comb_me=tenme|imp_2s_comb_te=tente|imp_2s_comb_nos=tennos|imp_2s_comb_lo=tenlo|imp_2s_comb_la=tenla|imp_2s_comb_le=tenle|imp_2s_comb_los=tenlos|imp_2s_comb_las=tenlas|imp_2s_comb_les=tenles|imp_3s_comb_me=téngame|imp_3s_comb_se=téngase|imp_3s_comb_nos=ténganos|imp_3s_comb_lo=téngalo|imp_3s_comb_la=téngala|imp_3s_comb_le=téngale|imp_3s_comb_los=téngalos|imp_3s_comb_las=téngalas|imp_3s_comb_les=téngales|imp_1p_comb_te=tengámoste|imp_1p_comb_nos=tengámonos|imp_1p_comb_os=tengámoos|imp_1p_comb_lo=tengámoslo|imp_1p_comb_la=tengámosla|imp_1p_comb_le=tengámosle|imp_1p_comb_los=tengámoslos|imp_1p_comb_las=tengámoslas|imp_1p_comb_les=tengámosles|imp_2p_comb_me=tenedme|imp_2p_comb_nos=tenednos|imp_2p_comb_os=teneos|imp_2p_comb_lo=tenedlo|imp_2p_comb_la=tenedla|imp_2p_comb_le=tenedle|imp_2p_comb_los=tenedlos|imp_2p_comb_las=tenedlas|imp_2p_comb_les=tenedles|imp_3p_comb_me=ténganme|imp_3p_comb_se=ténganse|imp_3p_comb_nos=téngannos|imp_3p_comb_lo=ténganlo|imp_3p_comb_la=ténganla|imp_3p_comb_le=ténganle|imp_3p_comb_los=ténganlos|imp_3p_comb_las=ténganlas|imp_3p_comb_les=ténganles"
    forms = M.do_generate_forms(args, from_headword, d, PAGENAME)
    assert len(forms["forms"]) == 309
    assert forms["forms"]["pres_1p"][0]["form"] == "tenemos"
    assert forms["forms"]["neg_imp_2s"][0]["form"] == "[[no]] [[tengas]]"
    joined = M.concat_forms(forms, d)
    compare(baseline, joined)

    PAGENAME = "hablar"
    baseline = "infinitive=hablar|infinitive_linked=hablar|gerund=hablando|pp_ms=hablado|pp_fs=hablada|pp_mp=hablados|pp_fp=habladas|pres_1s=hablo|pres_2s=hablas|pres_2sv=hablás|pres_3s=habla|pres_1p=hablamos|pres_2p=habláis|pres_3p=hablan|impf_1s=hablaba|impf_2s=hablabas|impf_3s=hablaba|impf_1p=hablábamos|impf_2p=hablabais|impf_3p=hablaban|pret_1s=hablé|pret_2s=hablaste|pret_3s=habló|pret_1p=hablamos|pret_2p=hablasteis|pret_3p=hablaron|fut_1s=hablaré|fut_2s=hablarás|fut_3s=hablará|fut_1p=hablaremos|fut_2p=hablaréis|fut_3p=hablarán|cond_1s=hablaría|cond_2s=hablarías|cond_3s=hablaría|cond_1p=hablaríamos|cond_2p=hablaríais|cond_3p=hablarían|pres_sub_1s=hable|pres_sub_2s=hables|pres_sub_2sv=hablés|pres_sub_3s=hable|pres_sub_1p=hablemos|pres_sub_2p=habléis|pres_sub_3p=hablen|impf_sub_ra_1s=hablara|impf_sub_ra_2s=hablaras|impf_sub_ra_3s=hablara|impf_sub_ra_1p=habláramos|impf_sub_ra_2p=hablarais|impf_sub_ra_3p=hablaran|impf_sub_se_1s=hablase|impf_sub_se_2s=hablases|impf_sub_se_3s=hablase|impf_sub_se_1p=hablásemos|impf_sub_se_2p=hablaseis|impf_sub_se_3p=hablasen|fut_sub_1s=hablare|fut_sub_2s=hablares|fut_sub_3s=hablare|fut_sub_1p=habláremos|fut_sub_2p=hablareis|fut_sub_3p=hablaren|imp_2s=habla|imp_2sv=hablá|imp_3s=hable|imp_1p=hablemos|imp_2p=hablad|imp_3p=hablen|neg_imp_2s=[[no]] [[hables]]|neg_imp_3s=[[no]] [[hable]]|neg_imp_1p=[[no]] [[hablemos]]|neg_imp_2p=[[no]] [[habléis]]|neg_imp_3p=[[no]] [[hablen]]|infinitive_comb_me=hablarme|infinitive_comb_te=hablarte|infinitive_comb_se=hablarse|infinitive_comb_nos=hablarnos|infinitive_comb_os=hablaros|infinitive_comb_lo=hablarlo|infinitive_comb_la=hablarla|infinitive_comb_le=hablarle|infinitive_comb_los=hablarlos|infinitive_comb_las=hablarlas|infinitive_comb_les=hablarles|gerund_comb_me=hablándome|gerund_comb_te=hablándote|gerund_comb_se=hablándose|gerund_comb_nos=hablándonos|gerund_comb_os=hablándoos|gerund_comb_lo=hablándolo|gerund_comb_la=hablándola|gerund_comb_le=hablándole|gerund_comb_los=hablándolos|gerund_comb_las=hablándolas|gerund_comb_les=hablándoles|imp_2s_comb_me=háblame|imp_2s_comb_te=háblate|imp_2s_comb_nos=háblanos|imp_2s_comb_lo=háblalo|imp_2s_comb_la=háblala|imp_2s_comb_le=háblale|imp_2s_comb_los=háblalos|imp_2s_comb_las=háblalas|imp_2s_comb_les=háblales|imp_3s_comb_me=hábleme|imp_3s_comb_se=háblese|imp_3s_comb_nos=háblenos|imp_3s_comb_lo=háblelo|imp_3s_comb_la=háblela|imp_3s_comb_le=háblele|imp_3s_comb_los=háblelos|imp_3s_comb_las=háblelas|imp_3s_comb_les=hábleles|imp_1p_comb_te=hablémoste|imp_1p_comb_nos=hablémonos|imp_1p_comb_os=hablémoos|imp_1p_comb_lo=hablémoslo|imp_1p_comb_la=hablémosla|imp_1p_comb_le=hablémosle|imp_1p_comb_los=hablémoslos|imp_1p_comb_las=hablémoslas|imp_1p_comb_les=hablémosles|imp_2p_comb_me=habladme|imp_2p_comb_nos=habladnos|imp_2p_comb_os=hablaos|imp_2p_comb_lo=habladlo|imp_2p_comb_la=habladla|imp_2p_comb_le=habladle|imp_2p_comb_los=habladlos|imp_2p_comb_las=habladlas|imp_2p_comb_les=habladles|imp_3p_comb_me=háblenme|imp_3p_comb_se=háblense|imp_3p_comb_nos=háblennos|imp_3p_comb_lo=háblenlo|imp_3p_comb_la=háblenla|imp_3p_comb_le=háblenle|imp_3p_comb_los=háblenlos|imp_3p_comb_las=háblenlas|imp_3p_comb_les=háblenles"
    forms = M.do_generate_forms(args, from_headword, d, PAGENAME)
    joined = M.concat_forms(forms, d)
    compare(baseline, joined)

    PAGENAME = "ababillarse"
    #args = {1:None, "nocomb":"1"}
    baseline = ""
    forms = M.do_generate_forms(args, from_headword, d, PAGENAME)
    joined = M.concat_forms(forms, d)
    #compare(baseline, joined)


    forms = M.do_generate_forms(args, from_headword, d, "absolver")
    forms = M.do_generate_forms(args, from_headword, d, "adscribir")
    forms = M.do_generate_forms(args, from_headword, d, "advenir")
    forms = M.do_generate_forms(args, from_headword, d, "ir")

    forms = M.do_generate_forms(args, from_headword, d, "merecer")
    assert forms["forms"]["pres_sub_1p"][0]["form"] == "merezcamos"

    forms = M.do_generate_forms(args, from_headword, d, "rasguñar")
    baseline = "infinitive=rasguñar|infinitive_linked=rasguñar|gerund=rasguñando|pp_ms=rasguñado|pp_fs=rasguñada|pp_mp=rasguñados|pp_fp=rasguñadas|pres_1s=rasguño|pres_2s=rasguñas|pres_2sv=rasguñás|pres_3s=rasguña|pres_1p=rasguñamos|pres_2p=rasguñáis|pres_3p=rasguñan|impf_1s=rasguñaba|impf_2s=rasguñabas|impf_3s=rasguñaba|impf_1p=rasguñábamos|impf_2p=rasguñabais|impf_3p=rasguñaban|pret_1s=rasguñé|pret_2s=rasguñaste|pret_3s=rasguñó|pret_1p=rasguñamos|pret_2p=rasguñasteis|pret_3p=rasguñaron|fut_1s=rasguñaré|fut_2s=rasguñarás|fut_3s=rasguñará|fut_1p=rasguñaremos|fut_2p=rasguñaréis|fut_3p=rasguñarán|cond_1s=rasguñaría|cond_2s=rasguñarías|cond_3s=rasguñaría|cond_1p=rasguñaríamos|cond_2p=rasguñaríais|cond_3p=rasguñarían|pres_sub_1s=rasguñe|pres_sub_2s=rasguñes|pres_sub_2sv=rasguñés|pres_sub_3s=rasguñe|pres_sub_1p=rasguñemos|pres_sub_2p=rasguñéis|pres_sub_3p=rasguñen|impf_sub_ra_1s=rasguñara|impf_sub_ra_2s=rasguñaras|impf_sub_ra_3s=rasguñara|impf_sub_ra_1p=rasguñáramos|impf_sub_ra_2p=rasguñarais|impf_sub_ra_3p=rasguñaran|impf_sub_se_1s=rasguñase|impf_sub_se_2s=rasguñases|impf_sub_se_3s=rasguñase|impf_sub_se_1p=rasguñásemos|impf_sub_se_2p=rasguñaseis|impf_sub_se_3p=rasguñasen|fut_sub_1s=rasguñare|fut_sub_2s=rasguñares|fut_sub_3s=rasguñare|fut_sub_1p=rasguñáremos|fut_sub_2p=rasguñareis|fut_sub_3p=rasguñaren|imp_2s=rasguña|imp_2sv=rasguñá|imp_3s=rasguñe|imp_1p=rasguñemos|imp_2p=rasguñad|imp_3p=rasguñen|neg_imp_2s=[[no]] [[rasguñes]]|neg_imp_3s=[[no]] [[rasguñe]]|neg_imp_1p=[[no]] [[rasguñemos]]|neg_imp_2p=[[no]] [[rasguñéis]]|neg_imp_3p=[[no]] [[rasguñen]]|infinitive_comb_me=rasguñarme|infinitive_comb_te=rasguñarte|infinitive_comb_se=rasguñarse|infinitive_comb_nos=rasguñarnos|infinitive_comb_os=rasguñaros|infinitive_comb_lo=rasguñarlo|infinitive_comb_la=rasguñarla|infinitive_comb_le=rasguñarle|infinitive_comb_los=rasguñarlos|infinitive_comb_las=rasguñarlas|infinitive_comb_les=rasguñarles|gerund_comb_me=rasguñándome|gerund_comb_te=rasguñándote|gerund_comb_se=rasguñándose|gerund_comb_nos=rasguñándonos|gerund_comb_os=rasguñándoos|gerund_comb_lo=rasguñándolo|gerund_comb_la=rasguñándola|gerund_comb_le=rasguñándole|gerund_comb_los=rasguñándolos|gerund_comb_las=rasguñándolas|gerund_comb_les=rasguñándoles|imp_2s_comb_me=rasgúñame|imp_2s_comb_te=rasgúñate|imp_2s_comb_nos=rasgúñanos|imp_2s_comb_lo=rasgúñalo|imp_2s_comb_la=rasgúñala|imp_2s_comb_le=rasgúñale|imp_2s_comb_los=rasgúñalos|imp_2s_comb_las=rasgúñalas|imp_2s_comb_les=rasgúñales|imp_3s_comb_me=rasgúñeme|imp_3s_comb_se=rasgúñese|imp_3s_comb_nos=rasgúñenos|imp_3s_comb_lo=rasgúñelo|imp_3s_comb_la=rasgúñela|imp_3s_comb_le=rasgúñele|imp_3s_comb_los=rasgúñelos|imp_3s_comb_las=rasgúñelas|imp_3s_comb_les=rasgúñeles|imp_1p_comb_te=rasguñémoste|imp_1p_comb_nos=rasguñémonos|imp_1p_comb_os=rasguñémoos|imp_1p_comb_lo=rasguñémoslo|imp_1p_comb_la=rasguñémosla|imp_1p_comb_le=rasguñémosle|imp_1p_comb_los=rasguñémoslos|imp_1p_comb_las=rasguñémoslas|imp_1p_comb_les=rasguñémosles|imp_2p_comb_me=rasguñadme|imp_2p_comb_nos=rasguñadnos|imp_2p_comb_os=rasguñaos|imp_2p_comb_lo=rasguñadlo|imp_2p_comb_la=rasguñadla|imp_2p_comb_le=rasguñadle|imp_2p_comb_los=rasguñadlos|imp_2p_comb_las=rasguñadlas|imp_2p_comb_les=rasguñadles|imp_3p_comb_me=rasgúñenme|imp_3p_comb_se=rasgúñense|imp_3p_comb_nos=rasgúñennos|imp_3p_comb_lo=rasgúñenlo|imp_3p_comb_la=rasgúñenla|imp_3p_comb_le=rasgúñenle|imp_3p_comb_los=rasgúñenlos|imp_3p_comb_las=rasgúñenlas|imp_3p_comb_les=rasgúñenles"
    joined = M.concat_forms(forms, d)
    compare(baseline, joined)

    forms = M.do_generate_forms({1:"<no_pres_stressed>", "pagename": "aterirse"}, from_headword, d, "aterirse")

    #joined = M.concat_forms(forms, d)
    #print(joined)
    #assert False

    # https://en.wiktionary.org/w/api.php?action=expandtemplates&format=json&prop=wikitext&text=%7B%7BUser:JeffDoozan/es-verb-generate-forms|mostrar%7D%7D
    #baseline = "infinitive=mostrar|infinitive_linked=mostrar|gerund=mostrando|pp_ms=mostrado|pp_fs=mostrada|pp_mp=mostrados|pp_fp=mostradas|pres_1s=mostro|pres_2s=mostras|pres_2sv=mostrás|pres_3s=mostra|pres_1p=mostramos|pres_2p=mostráis|pres_3p=mostran|impf_1s=mostraba|impf_2s=mostrabas|impf_3s=mostraba|impf_1p=mostrábamos|impf_2p=mostrabais|impf_3p=mostraban|pret_1s=mostré|pret_2s=mostraste|pret_3s=mostró|pret_1p=mostramos|pret_2p=mostrasteis|pret_3p=mostraron|fut_1s=mostraré|fut_2s=mostrarás|fut_3s=mostrará|fut_1p=mostraremos|fut_2p=mostraréis|fut_3p=mostrarán|cond_1s=mostraría|cond_2s=mostrarías|cond_3s=mostraría|cond_1p=mostraríamos|cond_2p=mostraríais|cond_3p=mostrarían|pres_sub_1s=mostre|pres_sub_2s=mostres|pres_sub_2sv=mostrés|pres_sub_3s=mostre|pres_sub_1p=mostremos|pres_sub_2p=mostréis|pres_sub_3p=mostren|impf_sub_ra_1s=mostrara|impf_sub_ra_2s=mostraras|impf_sub_ra_3s=mostrara|impf_sub_ra_1p=mostráramos|impf_sub_ra_2p=mostrarais|impf_sub_ra_3p=mostraran|impf_sub_se_1s=mostrase|impf_sub_se_2s=mostrases|impf_sub_se_3s=mostrase|impf_sub_se_1p=mostrásemos|impf_sub_se_2p=mostraseis|impf_sub_se_3p=mostrasen|fut_sub_1s=mostrare|fut_sub_2s=mostrares|fut_sub_3s=mostrare|fut_sub_1p=mostráremos|fut_sub_2p=mostrareis|fut_sub_3p=mostraren|imp_2s=mostra|imp_2sv=mostrá|imp_3s=mostre|imp_1p=mostremos|imp_2p=mostrad|imp_3p=mostren|neg_imp_2s=[[no]] [[mostres]]|neg_imp_3s=[[no]] [[mostre]]|neg_imp_1p=[[no]] [[mostremos]]|neg_imp_2p=[[no]] [[mostréis]]|neg_imp_3p=[[no]] [[mostren]]|infinitive_comb_me=mostrarme|infinitive_comb_te=mostrarte|infinitive_comb_se=mostrarse|infinitive_comb_nos=mostrarnos|infinitive_comb_os=mostraros|infinitive_comb_lo=mostrarlo|infinitive_comb_la=mostrarla|infinitive_comb_le=mostrarle|infinitive_comb_los=mostrarlos|infinitive_comb_las=mostrarlas|infinitive_comb_les=mostrarles|gerund_comb_me=mostrándome|gerund_comb_te=mostrándote|gerund_comb_se=mostrándose|gerund_comb_nos=mostrándonos|gerund_comb_os=mostrándoos|gerund_comb_lo=mostrándolo|gerund_comb_la=mostrándola|gerund_comb_le=mostrándole|gerund_comb_los=mostrándolos|gerund_comb_las=mostrándolas|gerund_comb_les=mostrándoles|imp_2s_comb_me=móstrame|imp_2s_comb_te=móstrate|imp_2s_comb_nos=móstranos|imp_2s_comb_lo=móstralo|imp_2s_comb_la=móstrala|imp_2s_comb_le=móstrale|imp_2s_comb_los=móstralos|imp_2s_comb_las=móstralas|imp_2s_comb_les=móstrales|imp_3s_comb_me=móstreme|imp_3s_comb_se=móstrese|imp_3s_comb_nos=móstrenos|imp_3s_comb_lo=móstrelo|imp_3s_comb_la=móstrela|imp_3s_comb_le=móstrele|imp_3s_comb_los=móstrelos|imp_3s_comb_las=móstrelas|imp_3s_comb_les=móstreles|imp_1p_comb_te=mostrémoste|imp_1p_comb_nos=mostrémonos|imp_1p_comb_os=mostrémoos|imp_1p_comb_lo=mostrémoslo|imp_1p_comb_la=mostrémosla|imp_1p_comb_le=mostrémosle|imp_1p_comb_los=mostrémoslos|imp_1p_comb_las=mostrémoslas|imp_1p_comb_les=mostrémosles|imp_2p_comb_me=mostradme|imp_2p_comb_nos=mostradnos|imp_2p_comb_os=mostraos|imp_2p_comb_lo=mostradlo|imp_2p_comb_la=mostradla|imp_2p_comb_le=mostradle|imp_2p_comb_los=mostradlos|imp_2p_comb_las=mostradlas|imp_2p_comb_les=mostradles|imp_3p_comb_me=móstrenme|imp_3p_comb_se=móstrense|imp_3p_comb_nos=móstrennos|imp_3p_comb_lo=móstrenlo|imp_3p_comb_la=móstrenla|imp_3p_comb_le=móstrenle|imp_3p_comb_los=móstrenlos|imp_3p_comb_las=móstrenlas|imp_3p_comb_les=móstrenles"
    #forms = M.do_generate_forms(args, from_headword, d, "mostrar<ue>")
    #joined = M.concat_forms(forms, d)
    #compare(baseline, joined)
    #print(joined)
    #assert False

    # 'https://en.wiktionary.org/w/api.php?action=expandtemplates&format=json&prop=wikitext&text=%7B%7BUser%3AJeffDoozan%2Fes-verb-generate-forms%7Cacertar%3Cie%3E%20con%7D%7D'
    # {{es-conj|acertar<ie> con|nocomb=1}}
    args = { 1: "acertar<ie> con" } #, "nocomb":1 }
    baseline = "infinitive=[[acertar]] [[con]]|infinitive_linked=[[acertar]] [[con]]|gerund=[[acertando]] [[con]]|pp_ms=[[acertado]] [[con]]|pp_fs=[[acertada]] [[con]]|pp_mp=[[acertados]] [[con]]|pp_fp=[[acertadas]] [[con]]|pres_1s=[[acierto]] [[con]]|pres_2s=[[aciertas]] [[con]]|pres_2sv=[[acertás]] [[con]]|pres_3s=[[acierta]] [[con]]|pres_1p=[[acertamos]] [[con]]|pres_2p=[[acertáis]] [[con]]|pres_3p=[[aciertan]] [[con]]|impf_1s=[[acertaba]] [[con]]|impf_2s=[[acertabas]] [[con]]|impf_3s=[[acertaba]] [[con]]|impf_1p=[[acertábamos]] [[con]]|impf_2p=[[acertabais]] [[con]]|impf_3p=[[acertaban]] [[con]]|pret_1s=[[acerté]] [[con]]|pret_2s=[[acertaste]] [[con]]|pret_3s=[[acertó]] [[con]]|pret_1p=[[acertamos]] [[con]]|pret_2p=[[acertasteis]] [[con]]|pret_3p=[[acertaron]] [[con]]|fut_1s=[[acertaré]] [[con]]|fut_2s=[[acertarás]] [[con]]|fut_3s=[[acertará]] [[con]]|fut_1p=[[acertaremos]] [[con]]|fut_2p=[[acertaréis]] [[con]]|fut_3p=[[acertarán]] [[con]]|cond_1s=[[acertaría]] [[con]]|cond_2s=[[acertarías]] [[con]]|cond_3s=[[acertaría]] [[con]]|cond_1p=[[acertaríamos]] [[con]]|cond_2p=[[acertaríais]] [[con]]|cond_3p=[[acertarían]] [[con]]|pres_sub_1s=[[acierte]] [[con]]|pres_sub_2s=[[aciertes]] [[con]]|pres_sub_2sv=[[acertés]] [[con]]|pres_sub_3s=[[acierte]] [[con]]|pres_sub_1p=[[acertemos]] [[con]]|pres_sub_2p=[[acertéis]] [[con]]|pres_sub_3p=[[acierten]] [[con]]|impf_sub_ra_1s=[[acertara]] [[con]]|impf_sub_ra_2s=[[acertaras]] [[con]]|impf_sub_ra_3s=[[acertara]] [[con]]|impf_sub_ra_1p=[[acertáramos]] [[con]]|impf_sub_ra_2p=[[acertarais]] [[con]]|impf_sub_ra_3p=[[acertaran]] [[con]]|impf_sub_se_1s=[[acertase]] [[con]]|impf_sub_se_2s=[[acertases]] [[con]]|impf_sub_se_3s=[[acertase]] [[con]]|impf_sub_se_1p=[[acertásemos]] [[con]]|impf_sub_se_2p=[[acertaseis]] [[con]]|impf_sub_se_3p=[[acertasen]] [[con]]|fut_sub_1s=[[acertare]] [[con]]|fut_sub_2s=[[acertares]] [[con]]|fut_sub_3s=[[acertare]] [[con]]|fut_sub_1p=[[acertáremos]] [[con]]|fut_sub_2p=[[acertareis]] [[con]]|fut_sub_3p=[[acertaren]] [[con]]|imp_2s=[[acierta]] [[con]]|imp_2sv=[[acertá]] [[con]]|imp_3s=[[acierte]] [[con]]|imp_1p=[[acertemos]] [[con]]|imp_2p=[[acertad]] [[con]]|imp_3p=[[acierten]] [[con]]|neg_imp_2s=[[no]] [[aciertes]] [[con]]|neg_imp_3s=[[no]] [[acierte]] [[con]]|neg_imp_1p=[[no]] [[acertemos]] [[con]]|neg_imp_2p=[[no]] [[acertéis]] [[con]]|neg_imp_3p=[[no]] [[acierten]] [[con]]|infinitive_comb_me=[[acertarme]] [[con]]|infinitive_comb_te=[[acertarte]] [[con]]|infinitive_comb_se=[[acertarse]] [[con]]|infinitive_comb_nos=[[acertarnos]] [[con]]|infinitive_comb_os=[[acertaros]] [[con]]|infinitive_comb_lo=[[acertarlo]] [[con]]|infinitive_comb_la=[[acertarla]] [[con]]|infinitive_comb_le=[[acertarle]] [[con]]|infinitive_comb_los=[[acertarlos]] [[con]]|infinitive_comb_las=[[acertarlas]] [[con]]|infinitive_comb_les=[[acertarles]] [[con]]|gerund_comb_me=[[acertándome]] [[con]]|gerund_comb_te=[[acertándote]] [[con]]|gerund_comb_se=[[acertándose]] [[con]]|gerund_comb_nos=[[acertándonos]] [[con]]|gerund_comb_os=[[acertándoos]] [[con]]|gerund_comb_lo=[[acertándolo]] [[con]]|gerund_comb_la=[[acertándola]] [[con]]|gerund_comb_le=[[acertándole]] [[con]]|gerund_comb_los=[[acertándolos]] [[con]]|gerund_comb_las=[[acertándolas]] [[con]]|gerund_comb_les=[[acertándoles]] [[con]]|imp_2s_comb_me=[[aciértame]] [[con]]|imp_2s_comb_te=[[aciértate]] [[con]]|imp_2s_comb_nos=[[aciértanos]] [[con]]|imp_2s_comb_lo=[[aciértalo]] [[con]]|imp_2s_comb_la=[[aciértala]] [[con]]|imp_2s_comb_le=[[aciértale]] [[con]]|imp_2s_comb_los=[[aciértalos]] [[con]]|imp_2s_comb_las=[[aciértalas]] [[con]]|imp_2s_comb_les=[[aciértales]] [[con]]|imp_3s_comb_me=[[aciérteme]] [[con]]|imp_3s_comb_se=[[aciértese]] [[con]]|imp_3s_comb_nos=[[aciértenos]] [[con]]|imp_3s_comb_lo=[[aciértelo]] [[con]]|imp_3s_comb_la=[[aciértela]] [[con]]|imp_3s_comb_le=[[aciértele]] [[con]]|imp_3s_comb_los=[[aciértelos]] [[con]]|imp_3s_comb_las=[[aciértelas]] [[con]]|imp_3s_comb_les=[[aciérteles]] [[con]]|imp_1p_comb_te=[[acertémoste]] [[con]]|imp_1p_comb_nos=[[acertémonos]] [[con]]|imp_1p_comb_os=[[acertémoos]] [[con]]|imp_1p_comb_lo=[[acertémoslo]] [[con]]|imp_1p_comb_la=[[acertémosla]] [[con]]|imp_1p_comb_le=[[acertémosle]] [[con]]|imp_1p_comb_los=[[acertémoslos]] [[con]]|imp_1p_comb_las=[[acertémoslas]] [[con]]|imp_1p_comb_les=[[acertémosles]] [[con]]|imp_2p_comb_me=[[acertadme]] [[con]]|imp_2p_comb_nos=[[acertadnos]] [[con]]|imp_2p_comb_os=[[acertaos]] [[con]]|imp_2p_comb_lo=[[acertadlo]] [[con]]|imp_2p_comb_la=[[acertadla]] [[con]]|imp_2p_comb_le=[[acertadle]] [[con]]|imp_2p_comb_los=[[acertadlos]] [[con]]|imp_2p_comb_las=[[acertadlas]] [[con]]|imp_2p_comb_les=[[acertadles]] [[con]]|imp_3p_comb_me=[[aciértenme]] [[con]]|imp_3p_comb_se=[[aciértense]] [[con]]|imp_3p_comb_nos=[[aciértennos]] [[con]]|imp_3p_comb_lo=[[aciértenlo]] [[con]]|imp_3p_comb_la=[[aciértenla]] [[con]]|imp_3p_comb_le=[[aciértenle]] [[con]]|imp_3p_comb_los=[[aciértenlos]] [[con]]|imp_3p_comb_las=[[aciértenlas]] [[con]]|imp_3p_comb_les=[[aciértenles]] [[con]]"
    #baseline = "infinitive=acertar con|infinitive_linked=acertar con|gerund=acertando con|pp_ms=acertado con|pp_fs=acertada con|pp_mp=acertados con|pp_fp=acertadas con|pres_1s=acierto con|pres_2s=aciertas con|pres_2sv=acertás con|pres_3s=acierta con|pres_1p=acertamos con|pres_2p=acertáis con|pres_3p=aciertan con|impf_1s=acertaba con|impf_2s=acertabas con|impf_3s=acertaba con|impf_1p=acertábamos con|impf_2p=acertabais con|impf_3p=acertaban con|pret_1s=acerté con|pret_2s=acertaste con|pret_3s=acertó con|pret_1p=acertamos con|pret_2p=acertasteis con|pret_3p=acertaron con|fut_1s=acertaré con|fut_2s=acertarás con|fut_3s=acertará con|fut_1p=acertaremos con|fut_2p=acertaréis con|fut_3p=acertarán con|cond_1s=acertaría con|cond_2s=acertarías con|cond_3s=acertaría con|cond_1p=acertaríamos con|cond_2p=acertaríais con|cond_3p=acertarían con|pres_sub_1s=acierte con|pres_sub_2s=aciertes con|pres_sub_2sv=acertés con|pres_sub_3s=acierte con|pres_sub_1p=acertemos con|pres_sub_2p=acertéis con|pres_sub_3p=acierten con|impf_sub_ra_1s=acertara con|impf_sub_ra_2s=acertaras con|impf_sub_ra_3s=acertara con|impf_sub_ra_1p=acertáramos con|impf_sub_ra_2p=acertarais con|impf_sub_ra_3p=acertaran con|impf_sub_se_1s=acertase con|impf_sub_se_2s=acertases con|impf_sub_se_3s=acertase con|impf_sub_se_1p=acertásemos con|impf_sub_se_2p=acertaseis con|impf_sub_se_3p=acertasen con|fut_sub_1s=acertare con|fut_sub_2s=acertares con|fut_sub_3s=acertare con|fut_sub_1p=acertáremos con|fut_sub_2p=acertareis con|fut_sub_3p=acertaren con|imp_2s=acierta con|imp_2sv=acertá con|imp_3s=acierte con|imp_1p=acertemos con|imp_2p=acertad con|imp_3p=acierten con|neg_imp_2s=no aciertes con|neg_imp_3s=no acierte con|neg_imp_1p=no acertemos con|neg_imp_2p=no acertéis con|neg_imp_3p=no acierten con|infinitive_comb_me=acertarme con|infinitive_comb_te=acertarte con|infinitive_comb_se=acertarse con|infinitive_comb_nos=acertarnos con|infinitive_comb_os=acertaros con|infinitive_comb_lo=acertarlo con|infinitive_comb_la=acertarla con|infinitive_comb_le=acertarle con|infinitive_comb_los=acertarlos con|infinitive_comb_las=acertarlas con|infinitive_comb_les=acertarles con|gerund_comb_me=acertándome con|gerund_comb_te=acertándote con|gerund_comb_se=acertándose con|gerund_comb_nos=acertándonos con|gerund_comb_os=acertándoos con|gerund_comb_lo=acertándolo con|gerund_comb_la=acertándola con|gerund_comb_le=acertándole con|gerund_comb_los=acertándolos con|gerund_comb_las=acertándolas con|gerund_comb_les=acertándoles con|imp_2s_comb_me=aciértame con|imp_2s_comb_te=aciértate con|imp_2s_comb_nos=aciértanos con|imp_2s_comb_lo=aciértalo con|imp_2s_comb_la=aciértala con|imp_2s_comb_le=aciértale con|imp_2s_comb_los=aciértalos con|imp_2s_comb_las=aciértalas con|imp_2s_comb_les=aciértales con|imp_3s_comb_me=aciérteme con|imp_3s_comb_se=aciértese con|imp_3s_comb_nos=aciértenos con|imp_3s_comb_lo=aciértelo con|imp_3s_comb_la=aciértela con|imp_3s_comb_le=aciértele con|imp_3s_comb_los=aciértelos con|imp_3s_comb_las=aciértelas con|imp_3s_comb_les=aciérteles con|imp_1p_comb_te=acertémoste con|imp_1p_comb_nos=acertémonos con|imp_1p_comb_os=acertémoos con|imp_1p_comb_lo=acertémoslo con|imp_1p_comb_la=acertémosla con|imp_1p_comb_le=acertémosle con|imp_1p_comb_los=acertémoslos con|imp_1p_comb_las=acertémoslas con|imp_1p_comb_les=acertémosles con|imp_2p_comb_me=acertadme con|imp_2p_comb_nos=acertadnos con|imp_2p_comb_os=acertaos con|imp_2p_comb_lo=acertadlo con|imp_2p_comb_la=acertadla con|imp_2p_comb_le=acertadle con|imp_2p_comb_los=acertadlos con|imp_2p_comb_las=acertadlas con|imp_2p_comb_les=acertadles con|imp_3p_comb_me=aciértenme con|imp_3p_comb_se=aciértense con|imp_3p_comb_nos=aciértennos con|imp_3p_comb_lo=aciértenlo con|imp_3p_comb_la=aciértenla con|imp_3p_comb_le=aciértenle con|imp_3p_comb_los=aciértenlos con|imp_3p_comb_las=aciértenlas con|imp_3p_comb_les=aciértenles con"
    forms = M.do_generate_forms(args, from_headword, d, "acertar con")
    joined = M.concat_forms(forms, d)
    print(joined)
    compare(baseline, joined)

    PAGENAME = "bifurcarse"
    args = { 1: None }
    # curl 'https://en.wiktionary.org/w/api.php?action=expandtemplates&format=json&prop=wikitext&text=%7B%7BUser:JeffDoozan/es-verb-generate-forms|bifurcarse%7D%7D'
    baseline = "infinitive=bifurcarse|infinitive_linked=[[bifurcar]][[se]]|gerund=bifurc\u00e1ndose|pp_ms=bifurcado|pp_fs=bifurcada|pp_mp=bifurcados|pp_fp=bifurcadas|pres_1s=[[me]] [[bifurco]]|pres_2s=[[te]] [[bifurcas]]|pres_2sv=[[te]] [[bifurc\u00e1s]]|pres_3s=[[se]] [[bifurca]]|pres_1p=[[nos]] [[bifurcamos]]|pres_2p=[[os]] [[bifurc\u00e1is]]|pres_3p=[[se]] [[bifurcan]]|impf_1s=[[me]] [[bifurcaba]]|impf_2s=[[te]] [[bifurcabas]]|impf_3s=[[se]] [[bifurcaba]]|impf_1p=[[nos]] [[bifurc\u00e1bamos]]|impf_2p=[[os]] [[bifurcabais]]|impf_3p=[[se]] [[bifurcaban]]|pret_1s=[[me]] [[bifurqu\u00e9]]|pret_2s=[[te]] [[bifurcaste]]|pret_3s=[[se]] [[bifurc\u00f3]]|pret_1p=[[nos]] [[bifurcamos]]|pret_2p=[[os]] [[bifurcasteis]]|pret_3p=[[se]] [[bifurcaron]]|fut_1s=[[me]] [[bifurcar\u00e9]]|fut_2s=[[te]] [[bifurcar\u00e1s]]|fut_3s=[[se]] [[bifurcar\u00e1]]|fut_1p=[[nos]] [[bifurcaremos]]|fut_2p=[[os]] [[bifurcar\u00e9is]]|fut_3p=[[se]] [[bifurcar\u00e1n]]|cond_1s=[[me]] [[bifurcar\u00eda]]|cond_2s=[[te]] [[bifurcar\u00edas]]|cond_3s=[[se]] [[bifurcar\u00eda]]|cond_1p=[[nos]] [[bifurcar\u00edamos]]|cond_2p=[[os]] [[bifurcar\u00edais]]|cond_3p=[[se]] [[bifurcar\u00edan]]|pres_sub_1s=[[me]] [[bifurque]]|pres_sub_2s=[[te]] [[bifurques]]|pres_sub_2sv=[[te]] [[bifurqu\u00e9s]]|pres_sub_3s=[[se]] [[bifurque]]|pres_sub_1p=[[nos]] [[bifurquemos]]|pres_sub_2p=[[os]] [[bifurqu\u00e9is]]|pres_sub_3p=[[se]] [[bifurquen]]|impf_sub_ra_1s=[[me]] [[bifurcara]]|impf_sub_ra_2s=[[te]] [[bifurcaras]]|impf_sub_ra_3s=[[se]] [[bifurcara]]|impf_sub_ra_1p=[[nos]] [[bifurc\u00e1ramos]]|impf_sub_ra_2p=[[os]] [[bifurcarais]]|impf_sub_ra_3p=[[se]] [[bifurcaran]]|impf_sub_se_1s=[[me]] [[bifurcase]]|impf_sub_se_2s=[[te]] [[bifurcases]]|impf_sub_se_3s=[[se]] [[bifurcase]]|impf_sub_se_1p=[[nos]] [[bifurc\u00e1semos]]|impf_sub_se_2p=[[os]] [[bifurcaseis]]|impf_sub_se_3p=[[se]] [[bifurcasen]]|fut_sub_1s=[[me]] [[bifurcare]]|fut_sub_2s=[[te]] [[bifurcares]]|fut_sub_3s=[[se]] [[bifurcare]]|fut_sub_1p=[[nos]] [[bifurc\u00e1remos]]|fut_sub_2p=[[os]] [[bifurcareis]]|fut_sub_3p=[[se]] [[bifurcaren]]|imp_2s=bif\u00farcate|imp_2sv=bifurcate|imp_3s=bif\u00farquese|imp_1p=bifurqu\u00e9monos|imp_2p=bifurcaos|imp_3p=bif\u00farquense|neg_imp_2s=[[no]] [[te]] [[bifurques]]|neg_imp_3s=[[no]] [[se]] [[bifurque]]|neg_imp_1p=[[no]] [[nos]] [[bifurquemos]]|neg_imp_2p=[[no]] [[os]] [[bifurqu\u00e9is]]|neg_imp_3p=[[no]] [[se]] [[bifurquen]]|infinitive_comb_me=bifurcarme|infinitive_comb_te=bifurcarte|infinitive_comb_se=bifurcarse|infinitive_comb_nos=bifurcarnos|infinitive_comb_os=bifurcaros|infinitive_comb_lo=bifurcarlo|infinitive_comb_la=bifurcarla|infinitive_comb_le=bifurcarle|infinitive_comb_los=bifurcarlos|infinitive_comb_las=bifurcarlas|infinitive_comb_les=bifurcarles|gerund_comb_me=bifurc\u00e1ndome|gerund_comb_te=bifurc\u00e1ndote|gerund_comb_se=bifurc\u00e1ndose|gerund_comb_nos=bifurc\u00e1ndonos|gerund_comb_os=bifurc\u00e1ndoos|gerund_comb_lo=bifurc\u00e1ndolo|gerund_comb_la=bifurc\u00e1ndola|gerund_comb_le=bifurc\u00e1ndole|gerund_comb_los=bifurc\u00e1ndolos|gerund_comb_las=bifurc\u00e1ndolas|gerund_comb_les=bifurc\u00e1ndoles|imp_2s_comb_te=bif\u00farcate|imp_3s_comb_se=bif\u00farquese|imp_1p_comb_nos=bifurqu\u00e9monos|imp_2p_comb_os=bifurcaos|imp_3p_comb_se=bif\u00farquense"
    forms = M.do_generate_forms(args, from_headword, d, PAGENAME)
    assert len(forms["forms"]) == 179
    joined = M.concat_forms(forms, d)
    compare(baseline, joined)

    PAGENAME = "bifurcar"
    args = { 1: None }
    # curl 'https://en.wiktionary.org/w/api.php?action=expandtemplates&format=json&prop=wikitext&text=%7B%7BUser:JeffDoozan/es-verb-generate-forms|bifurcarse%7D%7D'
    baseline = "infinitive=bifurcar|infinitive_linked=bifurcar|gerund=bifurcando|pp_ms=bifurcado|pp_fs=bifurcada|pp_mp=bifurcados|pp_fp=bifurcadas|pres_1s=bifurco|pres_2s=bifurcas|pres_2sv=bifurc\u00e1s|pres_3s=bifurca|pres_1p=bifurcamos|pres_2p=bifurc\u00e1is|pres_3p=bifurcan|impf_1s=bifurcaba|impf_2s=bifurcabas|impf_3s=bifurcaba|impf_1p=bifurc\u00e1bamos|impf_2p=bifurcabais|impf_3p=bifurcaban|pret_1s=bifurqu\u00e9|pret_2s=bifurcaste|pret_3s=bifurc\u00f3|pret_1p=bifurcamos|pret_2p=bifurcasteis|pret_3p=bifurcaron|fut_1s=bifurcar\u00e9|fut_2s=bifurcar\u00e1s|fut_3s=bifurcar\u00e1|fut_1p=bifurcaremos|fut_2p=bifurcar\u00e9is|fut_3p=bifurcar\u00e1n|cond_1s=bifurcar\u00eda|cond_2s=bifurcar\u00edas|cond_3s=bifurcar\u00eda|cond_1p=bifurcar\u00edamos|cond_2p=bifurcar\u00edais|cond_3p=bifurcar\u00edan|pres_sub_1s=bifurque|pres_sub_2s=bifurques|pres_sub_2sv=bifurqu\u00e9s|pres_sub_3s=bifurque|pres_sub_1p=bifurquemos|pres_sub_2p=bifurqu\u00e9is|pres_sub_3p=bifurquen|impf_sub_ra_1s=bifurcara|impf_sub_ra_2s=bifurcaras|impf_sub_ra_3s=bifurcara|impf_sub_ra_1p=bifurc\u00e1ramos|impf_sub_ra_2p=bifurcarais|impf_sub_ra_3p=bifurcaran|impf_sub_se_1s=bifurcase|impf_sub_se_2s=bifurcases|impf_sub_se_3s=bifurcase|impf_sub_se_1p=bifurc\u00e1semos|impf_sub_se_2p=bifurcaseis|impf_sub_se_3p=bifurcasen|fut_sub_1s=bifurcare|fut_sub_2s=bifurcares|fut_sub_3s=bifurcare|fut_sub_1p=bifurc\u00e1remos|fut_sub_2p=bifurcareis|fut_sub_3p=bifurcaren|imp_2s=bifurca|imp_2sv=bifurc\u00e1|imp_3s=bifurque|imp_1p=bifurquemos|imp_2p=bifurcad|imp_3p=bifurquen|neg_imp_2s=[[no]] [[bifurques]]|neg_imp_3s=[[no]] [[bifurque]]|neg_imp_1p=[[no]] [[bifurquemos]]|neg_imp_2p=[[no]] [[bifurqu\u00e9is]]|neg_imp_3p=[[no]] [[bifurquen]]|infinitive_comb_me=bifurcarme|infinitive_comb_te=bifurcarte|infinitive_comb_se=bifurcarse|infinitive_comb_nos=bifurcarnos|infinitive_comb_os=bifurcaros|infinitive_comb_lo=bifurcarlo|infinitive_comb_la=bifurcarla|infinitive_comb_le=bifurcarle|infinitive_comb_los=bifurcarlos|infinitive_comb_las=bifurcarlas|infinitive_comb_les=bifurcarles|gerund_comb_me=bifurc\u00e1ndome|gerund_comb_te=bifurc\u00e1ndote|gerund_comb_se=bifurc\u00e1ndose|gerund_comb_nos=bifurc\u00e1ndonos|gerund_comb_os=bifurc\u00e1ndoos|gerund_comb_lo=bifurc\u00e1ndolo|gerund_comb_la=bifurc\u00e1ndola|gerund_comb_le=bifurc\u00e1ndole|gerund_comb_los=bifurc\u00e1ndolos|gerund_comb_las=bifurc\u00e1ndolas|gerund_comb_les=bifurc\u00e1ndoles|imp_2s_comb_me=bif\u00farcame|imp_2s_comb_te=bif\u00farcate|imp_2s_comb_nos=bif\u00farcanos|imp_2s_comb_lo=bif\u00farcalo|imp_2s_comb_la=bif\u00farcala|imp_2s_comb_le=bif\u00farcale|imp_2s_comb_los=bif\u00farcalos|imp_2s_comb_las=bif\u00farcalas|imp_2s_comb_les=bif\u00farcales|imp_3s_comb_me=bif\u00farqueme|imp_3s_comb_se=bif\u00farquese|imp_3s_comb_nos=bif\u00farquenos|imp_3s_comb_lo=bif\u00farquelo|imp_3s_comb_la=bif\u00farquela|imp_3s_comb_le=bif\u00farquele|imp_3s_comb_los=bif\u00farquelos|imp_3s_comb_las=bif\u00farquelas|imp_3s_comb_les=bif\u00farqueles|imp_1p_comb_te=bifurqu\u00e9moste|imp_1p_comb_nos=bifurqu\u00e9monos|imp_1p_comb_os=bifurqu\u00e9moos|imp_1p_comb_lo=bifurqu\u00e9moslo|imp_1p_comb_la=bifurqu\u00e9mosla|imp_1p_comb_le=bifurqu\u00e9mosle|imp_1p_comb_los=bifurqu\u00e9moslos|imp_1p_comb_las=bifurqu\u00e9moslas|imp_1p_comb_les=bifurqu\u00e9mosles|imp_2p_comb_me=bifurcadme|imp_2p_comb_nos=bifurcadnos|imp_2p_comb_os=bifurcaos|imp_2p_comb_lo=bifurcadlo|imp_2p_comb_la=bifurcadla|imp_2p_comb_le=bifurcadle|imp_2p_comb_los=bifurcadlos|imp_2p_comb_las=bifurcadlas|imp_2p_comb_les=bifurcadles|imp_3p_comb_me=bif\u00farquenme|imp_3p_comb_se=bif\u00farquense|imp_3p_comb_nos=bif\u00farquennos|imp_3p_comb_lo=bif\u00farquenlo|imp_3p_comb_la=bif\u00farquenla|imp_3p_comb_le=bif\u00farquenle|imp_3p_comb_los=bif\u00farquenlos|imp_3p_comb_las=bif\u00farquenlas|imp_3p_comb_les=bif\u00farquenles"
    forms = M.do_generate_forms(args, from_headword, d, PAGENAME)
    assert len(forms["forms"]) == 309
    joined = M.concat_forms(forms, d)
    compare(baseline, joined)

    PAGENAME = "errar"
    args = { 1: '<ye[Spain],+[Latin America]>' }
    # curl 'https://en.wiktionary.org/w/api.php?action=expandtemplates&format=json&prop=wikitext&text=%7B%7BUser:JeffDoozan/es-verb-generate-forms|errar%3Cye%5BSpain%5D%2C%2B%5BLatin%20America%5D%3E%7D%7D'
    baseline = "infinitive=errar|infinitive_linked=errar|gerund=errando|pp_ms=errado|pp_fs=errada|pp_mp=errados|pp_fp=erradas|pres_1s=yerro,erro|pres_2s=yerras,erras|pres_2sv=errás|pres_3s=yerra,erra|pres_1p=erramos|pres_2p=erráis|pres_3p=yerran,erran|impf_1s=erraba|impf_2s=errabas|impf_3s=erraba|impf_1p=errábamos|impf_2p=errabais|impf_3p=erraban|pret_1s=erré|pret_2s=erraste|pret_3s=erró|pret_1p=erramos|pret_2p=errasteis|pret_3p=erraron|fut_1s=erraré|fut_2s=errarás|fut_3s=errará|fut_1p=erraremos|fut_2p=erraréis|fut_3p=errarán|cond_1s=erraría|cond_2s=errarías|cond_3s=erraría|cond_1p=erraríamos|cond_2p=erraríais|cond_3p=errarían|pres_sub_1s=yerre,erre|pres_sub_2s=yerres,erres|pres_sub_2sv=errés|pres_sub_3s=yerre,erre|pres_sub_1p=erremos|pres_sub_2p=erréis|pres_sub_3p=yerren,erren|impf_sub_ra_1s=errara|impf_sub_ra_2s=erraras|impf_sub_ra_3s=errara|impf_sub_ra_1p=erráramos|impf_sub_ra_2p=errarais|impf_sub_ra_3p=erraran|impf_sub_se_1s=errase|impf_sub_se_2s=errases|impf_sub_se_3s=errase|impf_sub_se_1p=errásemos|impf_sub_se_2p=erraseis|impf_sub_se_3p=errasen|fut_sub_1s=errare|fut_sub_2s=errares|fut_sub_3s=errare|fut_sub_1p=erráremos|fut_sub_2p=errareis|fut_sub_3p=erraren|imp_2s=yerra,erra|imp_2sv=errá|imp_3s=yerre,erre|imp_1p=erremos|imp_2p=errad|imp_3p=yerren,erren|neg_imp_2s=[[no]] [[yerres]],[[no]] [[erres]]|neg_imp_3s=[[no]] [[yerre]],[[no]] [[erre]]|neg_imp_1p=[[no]] [[erremos]]|neg_imp_2p=[[no]] [[erréis]]|neg_imp_3p=[[no]] [[yerren]],[[no]] [[erren]]|infinitive_comb_me=errarme|infinitive_comb_te=errarte|infinitive_comb_se=errarse|infinitive_comb_nos=errarnos|infinitive_comb_os=erraros|infinitive_comb_lo=errarlo|infinitive_comb_la=errarla|infinitive_comb_le=errarle|infinitive_comb_los=errarlos|infinitive_comb_las=errarlas|infinitive_comb_les=errarles|gerund_comb_me=errándome|gerund_comb_te=errándote|gerund_comb_se=errándose|gerund_comb_nos=errándonos|gerund_comb_os=errándoos|gerund_comb_lo=errándolo|gerund_comb_la=errándola|gerund_comb_le=errándole|gerund_comb_los=errándolos|gerund_comb_las=errándolas|gerund_comb_les=errándoles|imp_2s_comb_me=yérrame,érrame|imp_2s_comb_te=yérrate,érrate|imp_2s_comb_nos=yérranos,érranos|imp_2s_comb_lo=yérralo,érralo|imp_2s_comb_la=yérrala,érrala|imp_2s_comb_le=yérrale,érrale|imp_2s_comb_los=yérralos,érralos|imp_2s_comb_las=yérralas,érralas|imp_2s_comb_les=yérrales,érrales|imp_3s_comb_me=yérreme,érreme|imp_3s_comb_se=yérrese,érrese|imp_3s_comb_nos=yérrenos,érrenos|imp_3s_comb_lo=yérrelo,érrelo|imp_3s_comb_la=yérrela,érrela|imp_3s_comb_le=yérrele,érrele|imp_3s_comb_los=yérrelos,érrelos|imp_3s_comb_las=yérrelas,érrelas|imp_3s_comb_les=yérreles,érreles|imp_1p_comb_te=errémoste|imp_1p_comb_nos=errémonos|imp_1p_comb_os=errémoos|imp_1p_comb_lo=errémoslo|imp_1p_comb_la=errémosla|imp_1p_comb_le=errémosle|imp_1p_comb_los=errémoslos|imp_1p_comb_las=errémoslas|imp_1p_comb_les=errémosles|imp_2p_comb_me=erradme|imp_2p_comb_nos=erradnos|imp_2p_comb_os=erraos|imp_2p_comb_lo=erradlo|imp_2p_comb_la=erradla|imp_2p_comb_le=erradle|imp_2p_comb_los=erradlos|imp_2p_comb_las=erradlas|imp_2p_comb_les=erradles|imp_3p_comb_me=yérrenme,érrenme|imp_3p_comb_se=yérrense,érrense|imp_3p_comb_nos=yérrennos,érrennos|imp_3p_comb_lo=yérrenlo,érrenlo|imp_3p_comb_la=yérrenla,érrenla|imp_3p_comb_le=yérrenle,érrenle|imp_3p_comb_los=yérrenlos,érrenlos|imp_3p_comb_las=yérrenlas,érrenlas|imp_3p_comb_les=yérrenles,érrenles"
    forms = M.do_generate_forms(args, from_headword, d, PAGENAME)
    assert len(forms["forms"]) == 309
    joined = M.concat_forms(forms, d)
    compare(baseline, joined)


